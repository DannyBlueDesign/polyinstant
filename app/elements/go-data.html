<polymer-element name="go-data" attributes="key query">
  <template></template>

  <script>
    (function() {
      /*
       * Return desired Key
       */
      function _getKey(con, keyName) {
        return con.rooms[0].key(keyName);
      }

//      /*
//       * Return all data from key
//       */
//      function _findAll(key, callback) {
//        key.get().then(function(res) {
//
//          if(callback) {
//            callback(res);
//          }
//
//          return res.value;
//        });
//      }

      /*
       * Return queried data from key
       */
      function _find(key, params, callback) {
        var queryString;

        if(params) {
          queryString = JSON.parse( params.replace(/\'/g, "\"") );
        } else {
         queryString = {};
        }

        var query = key.query( queryString );

        query.execute(function(err, res) {
          if (err) {
            throw err;
          }

          if(callback) {
            callback(res);
          }

          return res;
        });
      }

      Polymer('go-data', {
        key: null,
        query: null,

        ready: function() {
          this.addEventListener('gotKey', function(key) {

            _find(key.detail.key, this.query, function(res) {

              this.fire('gotData', {data: res});

            }.bind(this));

          });

          document.addEventListener('connected', function(con) {

            var key = _getKey(con.detail.connection, this.key);

            this.fire('gotKey', {key: key});

          }.bind(this));
        }
      });
    })();
  </script>
</polymer-element>