<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="go-connect" attributes="account app room">
  <template></template>

  <script>
    Polymer('go-connect', {
      // Placeholders for account and app ids
      account: null,
      app: null,
      room: null,

      /*
       * Connect to goinstant app
       * Returns promise
       */
      connect: function() {
        var url = 'https://goinstant.net/' + this.account + '/' + this.app;

        var opts = {};

        if(this.room) {
          opts.room = this.room;
        }

        return goinstant.connect(url, opts);
      },

      /*
       * Get all data from specified key
       * Requires connection promise result and key name
       */
      getAllData: function(con, roomKey, callback) {
        if(!con || !roomKey) {
          console.error('ERR: connection object and roomKey name is required');
          return;
        }

        var key = con.rooms[0].key(roomKey);

        key.get().then(function(res) {
          if(callback) {
            callback(res.value);
          }

          return res.value;
        });
      },

      /*
       * Add new data to specified key
       * Requires connection promise results, key name and value to be saved
       */
      addData: function(con, roomKey, val, callback) {
        var key = con.rooms[0].key(roomKey);

        key.add(val, function(err, newValue) {
          if(err) {
            console.error('ERR: ' + err);

            return err;
          }

          if(callback) {
            callback(newValue);
          }

          return newValue;
        });
      }
    });
  </script>
</polymer-element>