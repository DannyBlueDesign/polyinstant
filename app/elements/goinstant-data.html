<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="goinstant-connect.html">

<polymer-element name="go-data" extends="go-connect" attributes="key">
  <template></template>

  <script>
    Polymer('go-data', {
      // Placeholders for account and app ids
      key: null,

      // Get specified key
      _getKey: function(con) {
        return con.rooms[0].key(this.key);
      },

      /*
       * Get all data from specified key
       * Requires connection promise result
       * returns object
       */
      findAll: function(con, callback) {
        if(!con) {
          throw 'ERR: a connection is required!';
        }

        var key = this._getKey(con);

        key.get().then(function(res) {
          if(callback) {
            callback(res);
          }

          return res;
        });
      },

      /*
       * Query data to get result
       * Requires connection promise result
       * returns array
       */
      find: function(con, params, callback) {
        var key = this._getKey(con);

        var query = key.query(params);

        query.execute(function(err, results) {
          if (err) {
            throw err;
          }

          if(callback) {
            callback(results);
          }

          return results;
        });
      },

      /*
       * Add new data to specified key
       * Requires connection promise results, and value to be saved
       */
      add: function(con, val, callback) {
        var key = this._getKey(con);

        key.add(val, function(err, newValue) {
          if(err) {
            throw err;
          }

          if(callback) {
            callback(newValue);
          }

          return newValue;
        });
      }
    });
  </script>
</polymer-element>